

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Data Preprocessing 1: Filtereren en samenvoegen &#8212; Data Story Project</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'docs/clean';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Data Preprocessing 2: Verwerken naar bestanden" href="test.html" />
    <link rel="prev" title="CO2-uitstoot van auto’s in de Europese Unie: Tussen afname en de noodzaak tot verdere reductie" href="story.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="story.html">
  
  
  
  
  
    <p class="title logo__title">Data Story Project</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="story.html">
                    CO2-uitstoot van auto’s in de Europese Unie: Tussen afname en de noodzaak tot verdere reductie
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Data Preprocessing 1: Filtereren en samenvoegen</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Data Preprocessing 2: Verwerken naar bestanden</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/FuYoshi/data_story_project" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/FuYoshi/data_story_project/issues/new?title=Issue%20on%20page%20%2Fdocs/clean.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/docs/clean.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Data Preprocessing 1: Filtereren en samenvoegen</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="data-preprocessing-1-filtereren-en-samenvoegen">
<h1>Data Preprocessing 1: Filtereren en samenvoegen<a class="headerlink" href="#data-preprocessing-1-filtereren-en-samenvoegen" title="Permalink to this heading">#</a></h1>
<p>Student namen: Laiba Shamsul, Popke Snoek, Yoshi Fu, Pepeyn Velthuijse</p>
<p>Team nummer: G4</p>
<p>Hieronder is de code weergegeven dat is gebruikt om de verschillende datasets te filteren en te combineren. Note that the code
is not actually executed as it would take approximately 3 hours to terminate. This is due to the amount of operations required
to filter string values in columns. Note that the code displayed below has never been executed. This is because the filtered
dataset was made by executing ‘<a class="reference external" href="http://clean.py">clean.py</a>’ in the GitHub repository (<a class="github reference external" href="https://github.com/FuYoshi/data_story_project">FuYoshi/data_story_project</a>). The code in
‘<a class="reference external" href="http://clean.py">clean.py</a>’ is displayed below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 1: Import libraries</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 2: Specify parameters</span>

<span class="c1"># Define chunk size to read the large csv files in chunks.</span>
<span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">1000000</span>

<span class="c1"># Define the original datasets that should be filtered and combined.</span>
<span class="n">csv_file_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;CO2_2015.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CO2_2016.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CO2_2017.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CO2_2018.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CO2_2019.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CO2_2020.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CO2_2021.csv&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Define the output file.</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;CO2_data.csv&quot;</span>

<span class="c1"># Remove rows in the datasets that have a missing value in the following columns.</span>
<span class="n">non_null_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="s2">&quot;Mk&quot;</span><span class="p">,</span> <span class="s2">&quot;Cn&quot;</span><span class="p">,</span> <span class="s2">&quot;m (kg)&quot;</span><span class="p">,</span> <span class="s2">&quot;W (mm)&quot;</span><span class="p">,</span> <span class="s2">&quot;Ft&quot;</span><span class="p">]</span>

<span class="c1"># Remove rows with the following values in the fuel type column.</span>
<span class="n">fuel_type_filter</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hydrogen&quot;</span><span class="p">]</span>

<span class="c1"># Only keep the following well-known car brands.</span>
<span class="n">car_makes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Avtokad&quot;</span><span class="p">,</span> <span class="s2">&quot;Aiways&quot;</span><span class="p">,</span> <span class="s2">&quot;Alfa Romeo&quot;</span><span class="p">,</span> <span class="s2">&quot;Alpina&quot;</span><span class="p">,</span> <span class="s2">&quot;Alpine&quot;</span><span class="p">,</span> <span class="s2">&quot;Ariel Atom&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Aston Martin&quot;</span><span class="p">,</span> <span class="s2">&quot;Audi&quot;</span><span class="p">,</span> <span class="s2">&quot;BAIC&quot;</span><span class="p">,</span> <span class="s2">&quot;Bentley&quot;</span><span class="p">,</span> <span class="s2">&quot;Benimar&quot;</span><span class="p">,</span> <span class="s2">&quot;BMW&quot;</span><span class="p">,</span> <span class="s2">&quot;Brabus&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Bugatti&quot;</span><span class="p">,</span> <span class="s2">&quot;Buick&quot;</span><span class="p">,</span> <span class="s2">&quot;BYD&quot;</span><span class="p">,</span> <span class="s2">&quot;Cadillac&quot;</span><span class="p">,</span> <span class="s2">&quot;Caterham&quot;</span><span class="p">,</span> <span class="s2">&quot;Chevrolet&quot;</span><span class="p">,</span> <span class="s2">&quot;Chrysler&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Citroën&quot;</span><span class="p">,</span> <span class="s2">&quot;CUPRA&quot;</span><span class="p">,</span> <span class="s2">&quot;Dacia&quot;</span><span class="p">,</span> <span class="s2">&quot;Daewoo&quot;</span><span class="p">,</span> <span class="s2">&quot;DFSK&quot;</span><span class="p">,</span> <span class="s2">&quot;Daf&quot;</span><span class="p">,</span> <span class="s2">&quot;Daihatsu&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Dallara&quot;</span><span class="p">,</span> <span class="s2">&quot;Datsun&quot;</span><span class="p">,</span> <span class="s2">&quot;DeLorean&quot;</span><span class="p">,</span> <span class="s2">&quot;Dodge&quot;</span><span class="p">,</span> <span class="s2">&quot;Donkervoort&quot;</span><span class="p">,</span> <span class="s2">&quot;Dreamer&quot;</span><span class="p">,</span> <span class="s2">&quot;DR&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DS&quot;</span><span class="p">,</span> <span class="s2">&quot;Ferrari&quot;</span><span class="p">,</span> <span class="s2">&quot;Fiat&quot;</span><span class="p">,</span> <span class="s2">&quot;Fisker&quot;</span><span class="p">,</span> <span class="s2">&quot;Ford&quot;</span><span class="p">,</span> <span class="s2">&quot;GINAF&quot;</span><span class="p">,</span> <span class="s2">&quot;GMC&quot;</span><span class="p">,</span> <span class="s2">&quot;Hino Motors&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Honda&quot;</span><span class="p">,</span> <span class="s2">&quot;Hummer&quot;</span><span class="p">,</span> <span class="s2">&quot;Hyundai&quot;</span><span class="p">,</span> <span class="s2">&quot;Infiniti&quot;</span><span class="p">,</span> <span class="s2">&quot;IVECO&quot;</span><span class="p">,</span> <span class="s2">&quot;JAC&quot;</span><span class="p">,</span> <span class="s2">&quot;Jaguar&quot;</span><span class="p">,</span> <span class="s2">&quot;Jeep&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Karma&quot;</span><span class="p">,</span> <span class="s2">&quot;KEAT&quot;</span><span class="p">,</span> <span class="s2">&quot;Kia&quot;</span><span class="p">,</span> <span class="s2">&quot;Koenigsegg&quot;</span><span class="p">,</span> <span class="s2">&quot;KTM&quot;</span><span class="p">,</span> <span class="s2">&quot;Lada&quot;</span><span class="p">,</span> <span class="s2">&quot;Lamborghini&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Land Rover&quot;</span><span class="p">,</span> <span class="s2">&quot;Lancia&quot;</span><span class="p">,</span> <span class="s2">&quot;Lexus&quot;</span><span class="p">,</span> <span class="s2">&quot;Lynk &amp; Co&quot;</span><span class="p">,</span> <span class="s2">&quot;Lotus&quot;</span><span class="p">,</span> <span class="s2">&quot;MAN&quot;</span><span class="p">,</span> <span class="s2">&quot;Mahindra&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Maserati&quot;</span><span class="p">,</span> <span class="s2">&quot;Maxus&quot;</span><span class="p">,</span> <span class="s2">&quot;Mazda&quot;</span><span class="p">,</span> <span class="s2">&quot;McLaren&quot;</span><span class="p">,</span> <span class="s2">&quot;Mercedes&quot;</span><span class="p">,</span> <span class="s2">&quot;Mini&quot;</span><span class="p">,</span> <span class="s2">&quot;Mitsubishi&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Morgan&quot;</span><span class="p">,</span> <span class="s2">&quot;Nissan&quot;</span><span class="p">,</span> <span class="s2">&quot;Nismo&quot;</span><span class="p">,</span> <span class="s2">&quot;Opel&quot;</span><span class="p">,</span> <span class="s2">&quot;Pagani&quot;</span><span class="p">,</span> <span class="s2">&quot;Peugeot&quot;</span><span class="p">,</span> <span class="s2">&quot;Polestar&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Porsche&quot;</span><span class="p">,</span> <span class="s2">&quot;Puma&quot;</span><span class="p">,</span> <span class="s2">&quot;Renault&quot;</span><span class="p">,</span> <span class="s2">&quot;Rolls Royce&quot;</span><span class="p">,</span> <span class="s2">&quot;Rover&quot;</span><span class="p">,</span> <span class="s2">&quot;Range Rover&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Saab&quot;</span><span class="p">,</span> <span class="s2">&quot;Scania&quot;</span><span class="p">,</span> <span class="s2">&quot;Scion&quot;</span><span class="p">,</span> <span class="s2">&quot;Seat&quot;</span><span class="p">,</span> <span class="s2">&quot;Škoda&quot;</span><span class="p">,</span> <span class="s2">&quot;Skywell&quot;</span><span class="p">,</span> <span class="s2">&quot;Smart&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SsangYong&quot;</span><span class="p">,</span> <span class="s2">&quot;Subaru&quot;</span><span class="p">,</span> <span class="s2">&quot;Suzuki&quot;</span><span class="p">,</span> <span class="s2">&quot;Tesla&quot;</span><span class="p">,</span> <span class="s2">&quot;Toyota&quot;</span><span class="p">,</span> <span class="s2">&quot;Tripod&quot;</span><span class="p">,</span> <span class="s2">&quot;UAZ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Volkswagen&quot;</span><span class="p">,</span> <span class="s2">&quot;Volvo&quot;</span><span class="p">,</span> <span class="s2">&quot;ZD&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Specify synonyms that car brands might use in the dataset (i.e. VW instead of Volkswagen).</span>
<span class="n">car_synonyms</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;VW&quot;</span><span class="p">:</span> <span class="s2">&quot;Volkswagen&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Citroen&quot;</span><span class="p">:</span> <span class="s2">&quot;Citroën&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Skoda&quot;</span><span class="p">:</span> <span class="s2">&quot;Skoda&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Mazda&quot;</span><span class="p">:</span> <span class="s2">&quot;placeholder1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Dreamer&quot;</span><span class="p">:</span> <span class="s2">&quot;placeholder2&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Define placeholders for car brands that are a subset of another brand (i.e. DR is a subset of DREAMER).</span>
<span class="n">car_placeholders</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;placeholder1&quot;</span><span class="p">:</span> <span class="s2">&quot;Mazda&quot;</span><span class="p">,</span>
    <span class="s2">&quot;placeholder2&quot;</span><span class="p">:</span> <span class="s2">&quot;Dreamer&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Define the column names that the original datasets use.</span>
<span class="n">COLS1</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MS&quot;</span><span class="p">,</span> <span class="s2">&quot;Mk&quot;</span><span class="p">,</span> <span class="s2">&quot;Cn&quot;</span><span class="p">,</span> <span class="s2">&quot;m (kg)&quot;</span><span class="p">,</span> <span class="s2">&quot;e (g/km)&quot;</span><span class="p">,</span> <span class="s2">&quot;w (mm)&quot;</span><span class="p">,</span> <span class="s2">&quot;Ft&quot;</span><span class="p">,</span> <span class="s2">&quot;Er (g/km)&quot;</span><span class="p">]</span>
<span class="n">COLS2</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MS&quot;</span><span class="p">,</span> <span class="s2">&quot;Mk&quot;</span><span class="p">,</span> <span class="s2">&quot;Cn&quot;</span><span class="p">,</span> <span class="s2">&quot;m (kg)&quot;</span><span class="p">,</span> <span class="s2">&quot;Enedc (g/km)&quot;</span><span class="p">,</span> <span class="s2">&quot;Ewltp (g/km)&quot;</span><span class="p">,</span> <span class="s2">&quot;W (mm)&quot;</span><span class="p">,</span> <span class="s2">&quot;Ft&quot;</span><span class="p">,</span> <span class="s2">&quot;Ernedc (g/km)&quot;</span><span class="p">,</span> <span class="s2">&quot;Erwltp (g/km)&quot;</span><span class="p">]</span>
<span class="n">COLS3</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="s2">&quot;Mk&quot;</span><span class="p">,</span> <span class="s2">&quot;Cn&quot;</span><span class="p">,</span> <span class="s2">&quot;m (kg)&quot;</span><span class="p">,</span> <span class="s2">&quot;Enedc (g/km)&quot;</span><span class="p">,</span> <span class="s2">&quot;Ewltp (g/km)&quot;</span><span class="p">,</span> <span class="s2">&quot;W (mm)&quot;</span><span class="p">,</span> <span class="s2">&quot;Ft&quot;</span><span class="p">,</span> <span class="s2">&quot;Ernedc (g/km)&quot;</span><span class="p">,</span> <span class="s2">&quot;Erwltp (g/km)&quot;</span><span class="p">]</span>
<span class="n">TYPE1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;MS&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Mk&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Cn&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;m (kg)&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;e (g/km)&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;w (mm)&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;Ft&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Er (g/km)&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">}</span>
<span class="n">TYPE2</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;MS&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Mk&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Cn&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;m (kg)&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;Enedc (g/km)&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;Ewltp (g/km)&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;W (mm)&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;Ft&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Ernedc (g/km)&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;Erwltp (g/km)&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">}</span>
<span class="n">TYPE3</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Country&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Mk&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Cn&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;m (kg)&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;Enedc (g/km)&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;Ewltp (g/km)&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;W (mm)&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;Ft&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Ernedc (g/km)&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;Erwltp (g/km)&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">}</span>
<span class="n">RENAME1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;MS&quot;</span><span class="p">:</span> <span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="s2">&quot;e (g/km)&quot;</span><span class="p">:</span> <span class="s2">&quot;Enedc (g/km)&quot;</span><span class="p">,</span> <span class="s2">&quot;w (mm)&quot;</span><span class="p">:</span> <span class="s2">&quot;W (mm)&quot;</span><span class="p">,</span> <span class="s2">&quot;Er (g/km)&quot;</span><span class="p">:</span> <span class="s2">&quot;Ernedc (g/km)&quot;</span><span class="p">}</span>
<span class="n">RENAME2</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;MS&quot;</span><span class="p">:</span> <span class="s2">&quot;Country&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 3: Read the csv files using the correct parameters.</span>
<span class="k">def</span> <span class="nf">_read_csv</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the csv files. Since the keys changed throughout the years, the</span>
<span class="sd">    arguments are set based on the year.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Configure the arguments of read_csv.</span>
    <span class="k">if</span> <span class="s2">&quot;2015&quot;</span> <span class="ow">in</span> <span class="n">csv_filename</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;usecols&quot;</span><span class="p">:</span> <span class="n">COLS1</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">TYPE1</span><span class="p">,</span> <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;sep&quot;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s2">&quot;rename&quot;</span><span class="p">:</span> <span class="n">RENAME1</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">}</span>
    <span class="k">elif</span> <span class="s2">&quot;2016&quot;</span> <span class="ow">in</span> <span class="n">csv_filename</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;usecols&quot;</span><span class="p">:</span> <span class="n">COLS1</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">TYPE1</span><span class="p">,</span> <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;utf-16&quot;</span><span class="p">,</span> <span class="s2">&quot;sep&quot;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s2">&quot;rename&quot;</span><span class="p">:</span> <span class="n">RENAME1</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2016</span><span class="p">}</span>
    <span class="k">elif</span> <span class="s2">&quot;2017&quot;</span> <span class="ow">in</span> <span class="n">csv_filename</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;usecols&quot;</span><span class="p">:</span> <span class="n">COLS2</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">TYPE2</span><span class="p">,</span> <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;utf-16&quot;</span><span class="p">,</span> <span class="s2">&quot;sep&quot;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s2">&quot;rename&quot;</span><span class="p">:</span> <span class="n">RENAME2</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2017</span><span class="p">}</span>
    <span class="k">elif</span> <span class="s2">&quot;2018&quot;</span> <span class="ow">in</span> <span class="n">csv_filename</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;usecols&quot;</span><span class="p">:</span> <span class="n">COLS2</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">TYPE2</span><span class="p">,</span> <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;sep&quot;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s2">&quot;rename&quot;</span><span class="p">:</span> <span class="n">RENAME2</span><span class="p">,</span>  <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2018</span><span class="p">}</span>
    <span class="k">elif</span> <span class="s2">&quot;2019&quot;</span> <span class="ow">in</span> <span class="n">csv_filename</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;usecols&quot;</span><span class="p">:</span> <span class="n">COLS3</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">TYPE3</span><span class="p">,</span> <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;sep&quot;</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s2">&quot;rename&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2019</span><span class="p">}</span>
    <span class="k">elif</span> <span class="s2">&quot;2020&quot;</span> <span class="ow">in</span> <span class="n">csv_filename</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;usecols&quot;</span><span class="p">:</span> <span class="n">COLS3</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">TYPE3</span><span class="p">,</span> <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;sep&quot;</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s2">&quot;rename&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2020</span><span class="p">}</span>
    <span class="k">elif</span> <span class="s2">&quot;2021&quot;</span> <span class="ow">in</span> <span class="n">csv_filename</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;usecols&quot;</span><span class="p">:</span> <span class="n">COLS3</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">TYPE3</span><span class="p">,</span> <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;sep&quot;</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s2">&quot;rename&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2021</span><span class="p">}</span>

    <span class="c1"># Read the csv using the arguments.</span>
    <span class="n">chunk_container</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">csv_filename</span><span class="p">,</span>
        <span class="n">usecols</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;usecols&quot;</span><span class="p">],</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;dtype&quot;</span><span class="p">],</span>
        <span class="n">chunksize</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span>
        <span class="n">sep</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;sep&quot;</span><span class="p">],</span>
        <span class="n">encoding</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;encoding&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunk_container</span><span class="p">:</span>
        <span class="c1"># Add missing columns.</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2015</span> <span class="ow">or</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2016</span><span class="p">:</span>
            <span class="n">chunk</span><span class="p">[</span><span class="s2">&quot;Ewltp (g/km)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">chunk</span><span class="p">[</span><span class="s2">&quot;Erwltp (g/km)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Add year column.</span>
        <span class="n">chunk</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;rename&quot;</span><span class="p">]:</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;rename&quot;</span><span class="p">])</span>
        <span class="c1"># Sort columns lexicographically for consistency.</span>
        <span class="k">yield</span> <span class="n">chunk</span><span class="p">[</span><span class="nb">sorted</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">columns</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 4: Filter de datasets and make the column values more consistent.</span>
<span class="k">def</span> <span class="nf">_filter</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filter out records with missing values.</span>
<span class="sd">    Filter out records with hydrogen as fuel type.</span>
<span class="sd">    Make fuel type naming convention consistent.</span>
<span class="sd">    Make make naming convention consistent.</span>
<span class="sd">    Make commercial name naming convention consistent.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">_filter_Ft</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">_filter_Mk</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">_filter_Cn</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">_convert_nedc</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>


<span class="k">def</span> <span class="nf">_filter_Ft</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make the naming convention of the fuel type column consistent.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure consistent naming convention in fuel types.</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Ft&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Ft&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># Filter out hydrogen and records with missing values.</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Ft&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">fuel_type_filter</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">non_null_columns</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="s1">&#39;columns&#39;</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">df</span>


<span class="k">def</span> <span class="nf">_filter_Mk</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make the naming convention of the make column consistent.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">make</span> <span class="ow">in</span> <span class="n">car_makes</span><span class="p">:</span>
        <span class="c1"># Change synonyms that might have been used (i.e. &quot;VW&quot;).</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">car_synonyms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Mk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="s2">&quot;Mk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="c1"># Replace str with its brand (i.e. &quot;Mercedes-Benz&quot; -&gt; &quot;Mercedes&quot;).</span>
        <span class="n">compare_make</span> <span class="o">=</span> <span class="n">make</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Mk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">compare_make</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="s2">&quot;Mk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">make</span>

    <span class="c1"># Convert placeholders back to their brand. This is because when a brand</span>
    <span class="c1"># contains the string &quot;dreamer&quot;, it automatically also contains the string</span>
    <span class="c1"># &quot;DR&quot;. Which is another brand.</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">car_placeholders</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Mk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="s2">&quot;Mk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="c1"># Remove everything that is not in the predefined brands.</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Mk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">car_makes</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">df</span>


<span class="k">def</span> <span class="nf">_filter_Cn</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert commercial names to uppercase and strip them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Cn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Cn&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">_convert_nedc</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If there is no WLTP data, convert NEDC to WLTP using conversion factor.</span>

<span class="sd">    Note that the new value is an estimation and not absolute.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">conversion_factor</span> <span class="o">=</span> <span class="mf">1.3</span>
    <span class="n">newcol</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Enedc (g/km)&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">conversion_factor</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Ewltp (g/km)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcol</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Ewltp (g/km)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="n">other</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Ewltp (g/km)&#39;</span><span class="p">])</span>
    <span class="n">newcol</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Ernedc (g/km)&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">conversion_factor</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Erwltp (g/km)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcol</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Erwltp (g/km)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="n">other</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Erwltp (g/km)&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 5: Save the resulting dataset into file. Since the original datasets are so big,</span>
<span class="c1"># the data of each chunk has to be written seperately.</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the csv files and filter them. Append the to the output file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">append_header</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Iterate over each csv file to filter and merge.</span>
    <span class="k">for</span> <span class="n">csv_filename</span> <span class="ow">in</span> <span class="n">csv_file_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">_read_csv</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">):</span>
            <span class="c1"># Filter the given chunk.</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">_filter</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

            <span class="c1"># Write the filtered chunk to the output file.</span>
            <span class="k">if</span> <span class="n">append_header</span><span class="p">:</span>
                <span class="n">chunk</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">append_header</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">chunk</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finished csv </span><span class="si">{</span><span class="n">csv_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Actually execute the above code. This is disabled as it would take approximately 3 hours.</span>
<span class="c1"># # This is due to the amount of operations required for each column value.</span>
<span class="c1"># if __name__ == &quot;__main__&quot;:</span>
<span class="c1">#     main()</span>
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="story.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">CO2-uitstoot van auto’s in de Europese Unie: Tussen afname en de noodzaak tot verdere reductie</p>
      </div>
    </a>
    <a class="right-next"
       href="test.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Data Preprocessing 2: Verwerken naar bestanden</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Group G4
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>